# Smol Models Nutrition API

This project is a FastAPI-based application that provides various AI-powered functionalities for image analysis and nutrition planning, designed to run on mobile devices using Termux.

## Features

- Image description generation
- Object detection in images
- Personalized meal planning
- Nutritional information analysis

## Endpoints

### 1. `/upload_image`

- **Method**: POST
- **Description**: Upload an image file to the server.
- **Input**: Image file
- **Output**: Confirmation message with saved image path

### 2. `/image_descr`

- **Method**: POST
- **Description**: Generate a detailed description of an uploaded image.
- **Input**: JSON with image name
- **Output**: Image description

### 3. `/image_text_from`

- **Method**: POST
- **Description**: Generate a personalized meal plan based on user data.
- **Input**: JSON with user medical, personal, fitness, and nutrition information
- **Output**: 3-day meal plan

### 4. `/text_from_day`

- **Method**: POST
- **Description**: Retrieve nutritional information for a specific day's meals.
- **Input**: JSON with day information
- **Output**: Detailed nutritional breakdown

### 5. `/detect_objects`

- **Method**: POST
- **Description**: Detect and locate objects in an uploaded image.
- **Input**: JSON with image name
- **Output**: List of detected objects with bounding boxes and confidence scores

## Required Files and Models

To run this project, you'll need the following files and models:

1. `qwen1_5-0_5b-chat-q4_k_m.gguf`: LLM model for text generation
2. `yolov8n.pt`: YOLO model for object detection
3. `Florence-2-large`: Pretrained model for image captioning (downloaded automatically)

## Setup and Running on Termux (Android)

1. Install Termux from the Google Play Store or F-Droid.

2. Open Termux and update the package lists:
`pkg update`
Copy
3. Install required packages:
`pkg install python opencv-python`
Copy
4. Install pip:
`pkg install python-pip`
Copy
5. Install the required Python packages:
`pip install fastapi uvicorn llama-cpp-python ultralytics pillow torch transformers`
Copy
Note: Some packages might take a while to install due to compilation on the mobile device.

6. Clone the project repository (if using git) or transfer the project files to your device.

7. Navigate to the project directory:
cd /path/to/project
Copy
8. Download the required model files:
- `qwen1_5-0_5b-chat-q4_k_m.gguf`
- `yolov8n.pt`

You can use `wget` or transfer them to your device manually.

9. Run the FastAPI server:
`python main.py`
Copy
The server will start on `http://0.0.0.0:8000`.

## Accessing the API

To access the API from other apps or browsers on your mobile device:

1. Find your device's IP address:
ifconfig
CopyLook for the `inet` address under the `wlan0` interface.

2. Use this IP address to access the API, e.g., `http://192.168.1.100:8000`

## Notes for Mobile Usage

- Ensure your Android device has sufficient storage space (at least 4GB free) for the models and dependencies.
- The app may run slower on mobile devices compared to desktop computers due to hardware limitations.
- Keep your device plugged in or ensure it has sufficient battery, as running AI models can be power-intensive.
- You may need to adjust the `uvicorn` server settings in `main.py` for better performance on mobile devices.

## Troubleshooting

- If you encounter memory errors, try closing other apps on your device.
- For permission issues, ensure Termux has the necessary permissions in your Android settings.
- If packages fail to install, try updating Termux and its packages to the latest version.
